import{t as e}from"./calendar-aV5gGbf_.js";import{t}from"./house-IZk9q2Ov.js";import{n,t as r}from"./phone-CFTnPSRe.js";import{A as i,D as a,G as o,S as s,W as c,Y as l,c as u,j as d,tt as f,u as p,x as m}from"./index-BK-GGJM4.js";var h=s(`user-plus`,[[`path`,{d:`M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2`,key:`1yyitq`}],[`circle`,{cx:`9`,cy:`7`,r:`4`,key:`nufk8`}],[`line`,{x1:`19`,x2:`19`,y1:`8`,y2:`14`,key:`1bvyxn`}],[`line`,{x1:`22`,x2:`16`,y1:`11`,y2:`11`,key:`1shjgl`}]]),g=f(l(),1),_=f(c(),1),v=f(i(),1),y=`https://be2.flaboratory.cloud`;function b(e=``){return String(e).normalize(`NFD`).replace(/[\u0300-\u036f]/g,``).replace(/đ/g,`d`).replace(/Đ/g,`D`)}function x(e=``){return String(e).replace(/\s+/g,` `).replace(/[\r\n\t]+/g,` `).trim()}function S(e,t=300){let[n,r]=(0,g.useState)(e);return(0,g.useEffect)(()=>{let n=setTimeout(()=>r(e),t);return()=>clearTimeout(n)},[e,t]),n}function C(e){let t=(0,g.useRef)(null);return(0,g.useEffect)(()=>{function n(n){t.current&&!t.current.contains(n.target)&&e()}return document.addEventListener(`mousedown`,n),()=>document.removeEventListener(`mousedown`,n)},[e]),t}function w({value:e,onChange:t,options:n,placeholder:r,disabled:i,loading:a,noOptionsText:o,searchPlaceholder:s,renderIcon:c,clearable:l=!0,className:u=``,debounceMs:d=300}){let[f,p]=(0,g.useState)(!1),[m,h]=(0,g.useState)(``),[_,y]=(0,g.useState)(-1),x=S(m,d),w=C(()=>{p(!1),h(``),y(-1)}),T=(0,g.useMemo)(()=>n.find(t=>String(t.value)===String(e))||null,[n,e]),E=(0,g.useMemo)(()=>{if(!x.trim())return n;let e=b(x.trim().toLowerCase());return n.filter(t=>b(String(t.label).toLowerCase()).includes(e))},[n,x]);(0,g.useEffect)(()=>{f||(h(``),y(-1))},[f]);function D(e){if(!f){(e.key===`ArrowDown`||e.key===`Enter`||e.key===` `)&&(e.preventDefault(),p(!0),y(0));return}if(e.key===`Escape`){e.preventDefault(),p(!1);return}e.key===`ArrowDown`?(e.preventDefault(),y(e=>Math.min(e+1,E.length-1))):e.key===`ArrowUp`?(e.preventDefault(),y(e=>Math.max(e-1,0))):e.key===`Enter`&&(e.preventDefault(),E[_]&&(t(E[_].value),p(!1)))}return(0,v.jsxs)(`div`,{ref:w,className:`relative ${u}`,children:[(0,v.jsx)(`button`,{type:`button`,disabled:i,onClick:()=>p(e=>!e),onKeyDown:D,className:`w-full rounded-xl border-2 px-4 py-3 text-left transition-all
          ${i?`bg-gray-50 cursor-not-allowed`:`bg-white hover:border-emerald-400`}
          ${f?`border-emerald-500`:`border-gray-200`}`,"aria-haspopup":`listbox`,"aria-expanded":f,children:(0,v.jsxs)(`div`,{className:`flex items-center gap-2`,children:[c?(0,v.jsx)(`span`,{className:`text-gray-400`,children:c}):null,(0,v.jsx)(`span`,{className:`${T?`text-gray-900`:`text-gray-400`}`,children:T?T.label:r||``}),(0,v.jsx)(`span`,{className:`ml-auto text-gray-400`,children:a?`…`:f?`▲`:`▼`}),l&&T&&!i&&(0,v.jsx)(`span`,{onClick:e=>{e.stopPropagation(),t(``)},className:`ml-2 text-gray-400 hover:text-gray-600 px-2`,role:`button`,"aria-label":`Clear`,title:`Clear`,children:`×`})]})}),f&&(0,v.jsxs)(`div`,{className:`absolute z-50 mt-2 w-full rounded-xl border-2 border-emerald-200 bg-white shadow-xl`,children:[(0,v.jsx)(`div`,{className:`p-2`,children:(0,v.jsx)(`input`,{autoFocus:!0,value:m,onChange:e=>{h(e.target.value),y(0)},onKeyDown:D,placeholder:s||`Search...`,className:`w-full rounded-lg border-2 border-gray-200 px-3 py-2 focus:outline-none focus:border-emerald-500`})}),(0,v.jsx)(`div`,{className:`max-h-64 overflow-auto py-1`,children:a?(0,v.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:`Loading...`}):E.length===0?(0,v.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:o||`No options`}):E.map((n,r)=>(0,v.jsx)(`div`,{role:`option`,"aria-selected":String(n.value)===String(e),onMouseEnter:()=>y(r),onMouseDown:e=>e.preventDefault(),onClick:()=>{t(n.value),p(!1)},className:`px-3 py-2 cursor-pointer
                    ${r===_?`bg-emerald-50`:``}
                    ${String(n.value)===String(e)?`font-medium text-emerald-700`:`text-gray-700`}`,children:n.label},n.value))})]})]})}function T(){let i=a(),[s,c]=(0,g.useState)({fullName:``,dateOfBirth:``,gender:`MALE`,phoneNumber:``,email:``,provinceCode:``,communeCode:``,houseNumber:``}),[l,f]=(0,g.useState)([]),[b,S]=(0,g.useState)([]),[C,T]=(0,g.useState)(!1),[E,D]=(0,g.useState)({});function O(e){return Array.isArray(e)?e:Array.isArray(e?.content)?e.content:Array.isArray(e?.data)?e.data:Array.isArray(e?.items)?e.items:Array.isArray(e?.results)?e.results:e&&typeof e==`object`?Object.values(e):[]}(0,g.useEffect)(()=>{let e=!0;return d.get(`/api/v1/addresses/provinces`).then(t=>{e&&f(O(t?.data?.provinces??t?.data))}).catch(t=>{e&&(console.error(`Failed to load provinces`,t),f([]))}),()=>e=!1},[]),(0,g.useEffect)(()=>{let{provinceCode:e}=s;if(!e){S([]);return}T(!0),d.get(`/api/v1/addresses/communes`,{params:{provinceCode:e,size:500,page:0}}).then(e=>{S(O(e?.data?.communes??e?.data))}).catch(e=>{console.error(`Failed to load communes`,e),S([])}).finally(()=>T(!1))},[s.provinceCode]);let k=e=>e,A=e=>/^[\p{L}\s'.-]+$/u.test(e.trim())?e.trim().replace(/\s+/g,` `).split(` `).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(` `):e,j=e=>e.replace(/\D/g,``),M=()=>{let e={};s.fullName.trim()?/^[\p{L}\s'.-]+$/u.test(s.fullName.trim())||(e.fullName=`Full name must contain only letters`):e.fullName=`Full name is required`,s.dateOfBirth||(e.dateOfBirth=`Date of birth is required`);let t=s.phoneNumber.trim();return t?/^\d{10}$/.test(t)?/^0\d{9}$/.test(t)||(e.phoneNumber=`Phone number must start with 0`):e.phoneNumber=`Phone number must be exactly 10 digits`:e.phoneNumber=`Phone number is required`,s.email.trim()!==``&&(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[A-Za-z]{2,}$/.test(s.email.trim())||(e.email=`Invalid email format`)),s.provinceCode||(e.provinceCode=`Province is required`),s.communeCode||(e.communeCode=`Commune/Ward is required`),s.houseNumber.trim()?/^[0-9A-Za-zÀ-ỹ\s,\.]+$/u.test(s.houseNumber.trim())||(e.houseNumber=`House number can contain letters, numbers, commas or dots only`):e.houseNumber=`House number/Street is required`,D(e),Object.keys(e).length===0},N=e=>{let{name:t,value:n}=e.target,r=n;t===`fullName`&&(r=k(r)),t===`phoneNumber`&&(r=j(r)),c(e=>({...e,[t]:r})),D(e=>({...e,[t]:``}))};function P(e){return(Array.isArray(l)?l:O(l)).find(t=>String(t.code)===String(e))||null}function F(e){return(Array.isArray(b)?b:O(b)).find(t=>String(t.code)===String(e))||null}let I=async e=>{if(e.preventDefault(),!M())return;let t=P(s.provinceCode),n=F(s.communeCode),r=x(s.houseNumber||``),a=[];r&&a.push(r),n&&n.name&&a.push(n.name),t&&t.name&&a.push(t.name);let c=a.join(`, `),l=localStorage.getItem(`lm.access`),u={fullName:s.fullName,dob:s.dateOfBirth,gender:s.gender,contactNumber:s.phoneNumber,email:s.email,address:c};try{await o.post(`${y}/api/v1/patients`,u,{headers:{Authorization:`Bearer ${l}`,"Content-Type":`application/json`}}),_.default.fire({icon:`success`,title:`Patient created!`,timer:1500}),i(`/patients`)}catch(e){_.default.fire({icon:`error`,title:`Error`,text:e.response?.data?.message||`Failed to create patient`})}},L=l.map(e=>({value:e.code,label:e.name})),R=b.map(e=>({value:e.code,label:e.name}));return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(`style`,{children:`
        @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fade-in 0.5s ease-out; }
      `}),(0,v.jsx)(`div`,{className:`min-h-screen bg-gradient-to-br from-emerald-50 via-sky-50 to-indigo-50 p-6`,children:(0,v.jsxs)(`div`,{className:`w-full mx-auto`,children:[(0,v.jsxs)(`button`,{onClick:()=>i(`/patients`),className:`inline-flex items-center gap-2 text-gray-600 hover:text-emerald-600 font-medium mb-6 transition-colors`,children:[(0,v.jsx)(m,{className:`w-5 h-5`}),`Back to Patients`]}),(0,v.jsxs)(`div`,{className:`bg-white rounded-3xl shadow-xl p-8 fade-in`,children:[(0,v.jsxs)(`div`,{className:`flex items-center gap-3 mb-8`,children:[(0,v.jsx)(`div`,{className:`p-3 rounded-2xl bg-gradient-to-br from-emerald-500 to-sky-600`,children:(0,v.jsx)(h,{className:`w-8 h-8 text-white`})}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`h1`,{className:`text-3xl font-bold bg-gradient-to-r from-emerald-600 to-sky-600 bg-clip-text text-transparent`,children:`Add New Patient`}),(0,v.jsx)(`p`,{className:`text-sm text-gray-500 mt-1`,children:`Fill in the patient information below`})]})]}),(0,v.jsxs)(`form`,{onSubmit:I,className:`space-y-6`,children:[(0,v.jsxs)(`div`,{className:`space-y-4`,children:[(0,v.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,v.jsx)(u,{className:`w-5 h-5 text-emerald-500`}),`Personal Information`]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Full Name `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(u,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,v.jsx)(`input`,{type:`text`,name:`fullName`,value:s.fullName,onChange:N,onBlur:()=>c(e=>({...e,fullName:A(e.fullName)})),autoComplete:`off`,placeholder:`Enter patient's full name`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),E.fullName&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.fullName})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Date of Birth `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(e,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,v.jsx)(`input`,{type:`date`,name:`dateOfBirth`,value:s.dateOfBirth,onChange:N,max:new Date().toISOString().split(`T`)[0],className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),E.dateOfBirth&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.dateOfBirth})]})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:`Gender`}),(0,v.jsxs)(`select`,{name:`gender`,value:s.gender,onChange:N,className:`w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-emerald-500 focus:outline-none`,children:[(0,v.jsx)(`option`,{value:`MALE`,children:`Male`}),(0,v.jsx)(`option`,{value:`FEMALE`,children:`Female`}),(0,v.jsx)(`option`,{value:`OTHER`,children:`Other`})]})]})]}),(0,v.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,v.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,v.jsx)(r,{className:`w-5 h-5 text-sky-500`}),`Contact Information`]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Phone Number `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(r,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,v.jsx)(`input`,{type:`text`,name:`phoneNumber`,value:s.phoneNumber,onChange:N,placeholder:`Enter phone number`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),E.phoneNumber&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.phoneNumber})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:`Email`}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(p,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,v.jsx)(`input`,{type:`email`,name:`email`,value:s.email,onChange:N,placeholder:`Enter email`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),E.email&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.email})]})]})]}),(0,v.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,v.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,v.jsx)(n,{className:`w-5 h-5 text-emerald-500`}),`Address Information`]}),(0,v.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Province / City `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsx)(w,{value:s.provinceCode,onChange:e=>c(t=>({...t,provinceCode:e,communeCode:``})),options:L,placeholder:`Select Province`,searchPlaceholder:`Search province...`,noOptionsText:`No results`,loading:!1,disabled:!1,renderIcon:(0,v.jsx)(n,{className:`w-5 h-5`}),debounceMs:250}),E.provinceCode&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.provinceCode})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Commune / Ward `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsx)(w,{value:s.communeCode,onChange:e=>c(t=>({...t,communeCode:e})),options:R,placeholder:`Select Commune`,searchPlaceholder:`Search commune...`,noOptionsText:`No results`,loading:C,disabled:!s.provinceCode,renderIcon:(0,v.jsx)(n,{className:`w-5 h-5`}),debounceMs:250}),E.communeCode&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.communeCode})]})]}),(0,v.jsxs)(`div`,{children:[(0,v.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`House Number / Street`,` `,(0,v.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,v.jsxs)(`div`,{className:`relative`,children:[(0,v.jsx)(t,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,v.jsx)(`input`,{name:`houseNumber`,value:s.houseNumber,onChange:N,placeholder:`Enter house number, street name...`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),E.houseNumber&&(0,v.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:E.houseNumber})]})]}),(0,v.jsxs)(`div`,{className:`flex justify-end gap-4 pt-6 border-t`,children:[(0,v.jsx)(`button`,{type:`button`,onClick:()=>i(`/patients`),className:`px-6 py-3 rounded-xl border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all`,children:`Cancel`}),(0,v.jsxs)(`button`,{type:`submit`,className:`px-8 py-3 rounded-xl text-white font-medium shadow-lg bg-gradient-to-r from-emerald-500 to-sky-600 hover:from-sky-600 hover:to-emerald-500 flex items-center gap-2`,children:[(0,v.jsx)(h,{className:`w-5 h-5`}),`Create Patient`]})]})]})]})]})})]})}export{T as default};