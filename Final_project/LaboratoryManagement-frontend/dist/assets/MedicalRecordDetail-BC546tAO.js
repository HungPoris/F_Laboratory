import{t as e}from"./CommentModal-DElnGMeh.js";import"./loader-circle-CGh2Y_RS.js";import{t}from"./message-square-CCLenbod.js";import{n,t as r}from"./trash-2-D1o_3E3w.js";import{t as i}from"./plus-C7x6RT7r.js";import{A as a,C as o,D as s,G as c,O as l,W as u,Y as d,m as f,tt as p}from"./index-BK-GGJM4.js";import{t as m}from"./PaginationControls-B_SYzLFE.js";var h=p(d(),1),g=p(u(),1),_=p(a(),1),v=`https://be2.flaboratory.cloud`,y={PENDING:1,IN_PROGRESS:2,COMPLETED:3,CANCELLED:4},b=e=>{switch(e){case`PENDING`:return`Pending`;case`IN_PROGRESS`:return`In progress`;case`COMPLETED`:return`Completed`;case`CANCELLED`:return`Cancelled`;default:return e||``}};function x(){let{patientId:a,recordId:u}=l(),d=s(),[p,x]=(0,h.useState)(null),[S,C]=(0,h.useState)(null),[w,T]=(0,h.useState)(!0),[E,D]=(0,h.useState)([]),[O,k]=(0,h.useState)([]),[A,j]=(0,h.useState)(!1),[M,N]=(0,h.useState)(`ALL`),[P,F]=(0,h.useState)(`ALL`),[I,L]=(0,h.useState)(0),[R,z]=(0,h.useState)(0),[B,V]=(0,h.useState)(0),[H,U]=(0,h.useState)(!1),[W,G]=(0,h.useState)(null),K=async(e,t={})=>{let n=localStorage.getItem(`lm.access`);return c({url:`${v}${e}`,...t,headers:{Authorization:n?`Bearer ${n}`:void 0,"Content-Type":`application/json`,...t.headers},withCredentials:!0})};(0,h.useEffect)(()=>{q(),J()},[a,u]),(0,h.useEffect)(()=>{u&&Q()},[u]);let q=async()=>{try{C((await K(`/api/v1/patients/${a}`)).data)}catch{}},J=async()=>{try{T(!0),x((await K(`/api/v1/patients/${a}/medical-records/${u}`)).data)}catch(e){g.default.fire({icon:`error`,title:`Error`,text:e.response?.data?.message||`Failed to load medical record details.`})}finally{T(!1)}},Y=async()=>{if((await g.default.fire({title:`Are you sure?`,text:`This medical record will be permanently deleted.`,icon:`warning`,showCancelButton:!0,confirmButtonColor:`#d33`,cancelButtonColor:`#3085d6`,confirmButtonText:`Yes, delete it`})).isConfirmed)try{await K(`/api/v1/patients/${a}/medical-records/${u}`,{method:`DELETE`}),g.default.fire({icon:`success`,title:`Deleted!`,text:`Medical record has been deleted.`,timer:1500}),d(`/patients/${a}`)}catch(e){g.default.fire({icon:`error`,title:`Failed`,text:e.response?.data?.message||`Unable to delete medical record.`})}},X=()=>p?typeof p.department==`string`?p.department||`N/A`:Array.isArray(p.departments)&&p.departments.length>0?p.departments.join(`, `):`N/A`:`N/A`,Z=(e,t=M,n=P,r=I)=>{let i=[...e];t!==`ALL`&&(i=i.filter(e=>e.status===t)),n!==`ALL`&&(i=i.filter(e=>e.priority===n)),i.sort((e,t)=>{let n=y[e.status]??99,r=y[t.status]??99;return n===r?new Date(t.createdAt)-new Date(e.createdAt):n-r});let a=i.length,o=Math.ceil(a/10),s=Math.min(r,o-1),c=s*10;D(i.slice(c,c+10)),V(a),z(o),L(s)},Q=async()=>{try{j(!0);let e=await K(`/api/v1/test-orders/by-medical-record/${u}`),t=Array.isArray(e.data)?e.data:e.data.items||[];k(t),N(`ALL`),F(`ALL`),L(0),Z(t,`ALL`,`ALL`,0)}catch{}finally{j(!1)}},$=()=>{if(!p)return;let e=S?.dob&&new Date().getFullYear()-new Date(S.dob).getFullYear();d(`/test-order/create`,{state:{medicalRecordId:u,patientId:a,patientName:S?.fullName,age:e,gender:S?.gender,phoneNumber:S?.contactNumber,email:S?.email,address:S?.address,dateOfBirth:S?.dob,clinicalNotes:p?.clinicalNotes}})},ee=e=>{N(e),Z(O,e,P,0)},te=e=>{F(e),Z(O,M,e,0)},ne=e=>{G(e),U(!0)},re=async e=>{if((await g.default.fire({title:`Delete Test Order?`,text:`This action cannot be undone.`,icon:`warning`,showCancelButton:!0,confirmButtonColor:`#ef4444`,cancelButtonColor:`#6b7280`,confirmButtonText:`Delete`})).isConfirmed)try{await K(`/api/v1/test-orders/${e.id}`,{method:`DELETE`}),g.default.fire(`Deleted!`,`Test order has been removed.`,`success`),Q()}catch(e){g.default.fire({icon:`error`,title:`Error`,text:e.response?.data?.message||`Failed to delete test order.`})}};return w?(0,_.jsx)(`div`,{className:`flex items-center justify-center min-h-screen`,children:`Loading...`}):p?(I+1,(0,_.jsxs)(`div`,{className:`min-h-screen bg-gradient-to-br from-cyan-50 via-blue-50 to-teal-50`,children:[(0,_.jsxs)(`div`,{className:`container mx-auto px-6 py-8`,children:[(0,_.jsx)(o,{to:`/patients/${a}`,className:`inline-flex items-center text-cyan-600 hover:text-teal-600 font-medium mb-4`,children:`â† Back to Patient Details`}),(0,_.jsx)(`div`,{className:`bg-white rounded-lg shadow-md p-6 border-l-4 border-cyan-500 mb-8`,children:(0,_.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,_.jsx)(`h1`,{className:`text-3xl font-bold text-gray-900`,children:`Medical Record Details`}),(0,_.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,_.jsxs)(`button`,{onClick:()=>d(`/patients/${a}/medical-records/${u}/edit`),className:`inline-flex items-center gap-2 px-5 py-2 bg-teal-50 text-teal-600 rounded-md hover:bg-teal-100 transition-colors duration-150 font-medium`,children:[(0,_.jsx)(n,{className:`w-5 h-5`}),` Edit`]}),(0,_.jsxs)(`button`,{onClick:Y,className:`inline-flex items-center gap-2 px-5 py-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors duration-150 font-medium`,children:[(0,_.jsx)(r,{className:`w-5 h-5`}),` Delete`]})]})]})}),(0,_.jsxs)(`div`,{className:`bg-white rounded-lg shadow-md p-6 border-l-4 border-cyan-500 mb-8`,children:[(0,_.jsx)(`h2`,{className:`text-xl font-semibold text-gray-800 mb-4 border-b pb-2`,children:`Patient Information`}),(0,_.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Full Name`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.fullName||`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Date of Birth`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.dob?new Date(S.dob).toISOString().slice(0,10):`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Gender`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.gender||`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Phone Number`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.contactNumber||`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Email`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.email||`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Address`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:S?.address||`N/A`})]})]}),(0,_.jsx)(`h2`,{className:`text-xl font-semibold text-gray-800 mb-4 `,children:`Record Information`}),(0,_.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`,children:[(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Record Code`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:p.recordCode})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Visit Date`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:p.visitDate?new Date(p.visitDate).toLocaleString():`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Chief Complaint`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:p.chiefComplaint||`N/A`})]}),(0,_.jsxs)(`div`,{children:[(0,_.jsx)(`label`,{className:`text-sm text-gray-500 font-medium mb-1 block`,children:`Departments`}),(0,_.jsx)(`p`,{className:`text-gray-900 font-medium`,children:X()})]})]})]}),(0,_.jsxs)(`div`,{className:`mt-8 bg-white rounded-lg shadow-md p-6 border-l-4 border-cyan-500`,children:[(0,_.jsxs)(`div`,{className:`flex items-center justify-between mb-4`,children:[(0,_.jsx)(`h2`,{className:`text-xl font-semibold text-gray-800`,children:`Test Orders`}),(0,_.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,_.jsxs)(`button`,{onClick:$,className:`inline-flex items-center gap-2 bg-gradient-to-r from-cyan-500 to-teal-500 text-white px-5 py-2 rounded-md hover:from-cyan-600 hover:to-teal-600 shadow-md hover:shadow-lg transition-all duration-200 font-medium`,children:[(0,_.jsx)(i,{className:`w-5 h-5`}),`New Test Order`]}),(0,_.jsxs)(`button`,{onClick:()=>Q(),className:`inline-flex items-center gap-2 px-5 py-2 rounded-md border border-cyan-500 text-cyan-700 hover:bg-cyan-50 transition-colors duration-150 font-medium`,children:[(0,_.jsx)(`svg`,{className:`w-5 h-5`,fill:`none`,stroke:`currentColor`,viewBox:`0 0 24 24`,children:(0,_.jsx)(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M4 4v5h.582m15.356 2A8 8 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8 8 0 01-15.357-2m15.357 2H15`})}),`Refresh`]})]})]}),A?(0,_.jsxs)(`div`,{className:`text-center py-8`,children:[(0,_.jsx)(`div`,{className:`inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-600`}),(0,_.jsx)(`p`,{className:`mt-2 text-gray-600`,children:`Loading test orders...`})]}):O.length===0?(0,_.jsx)(`div`,{className:`text-center py-12 text-gray-500 font-medium`,children:`No test orders found.`}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(`div`,{className:`overflow-x-auto`,children:(0,_.jsxs)(`table`,{className:`min-w-full divide-y divide-gray-200`,children:[(0,_.jsx)(`thead`,{className:`bg-gray-50`,children:(0,_.jsxs)(`tr`,{children:[(0,_.jsx)(`th`,{className:`px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase`,children:`Test Order`}),(0,_.jsx)(`th`,{className:`px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase`,children:(0,_.jsxs)(`select`,{value:M,onChange:e=>ee(e.target.value),className:`border rounded-md px-2 py-1 text-xs bg-white cursor-pointer outline-none focus:ring-2 focus:ring-cyan-500`,children:[(0,_.jsx)(`option`,{value:`ALL`,children:`Status`}),(0,_.jsx)(`option`,{value:`PENDING`,children:`Pending`}),(0,_.jsx)(`option`,{value:`IN_PROGRESS`,children:`In progress`}),(0,_.jsx)(`option`,{value:`COMPLETED`,children:`Completed`}),(0,_.jsx)(`option`,{value:`CANCELLED`,children:`Cancelled`})]})}),(0,_.jsx)(`th`,{className:`px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase`,children:(0,_.jsxs)(`select`,{value:P,onChange:e=>te(e.target.value),className:`border rounded-md px-2 py-1 text-xs bg-white cursor-pointer outline-none focus:ring-2 focus:ring-cyan-500`,children:[(0,_.jsx)(`option`,{value:`ALL`,children:`Priority`}),(0,_.jsx)(`option`,{value:`URGENT`,children:`Urgent`}),(0,_.jsx)(`option`,{value:`HIGH`,children:`High`}),(0,_.jsx)(`option`,{value:`NORMAL`,children:`Normal`}),(0,_.jsx)(`option`,{value:`LOW`,children:`Low`})]})}),(0,_.jsx)(`th`,{className:`px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase`,children:`Actions`})]})}),(0,_.jsx)(`tbody`,{className:`bg-white divide-y divide-gray-100`,children:E.map(e=>(0,_.jsxs)(`tr`,{className:`hover:bg-cyan-50 transition-colors duration-150`,children:[(0,_.jsx)(`td`,{className:`px-6 py-4 text-sm font-semibold text-gray-700`,children:e.orderNumber?`Test Order ${e.orderNumber}`:`Order #${e.id}`}),(0,_.jsx)(`td`,{className:`px-6 py-4 text-sm`,children:(0,_.jsx)(`span`,{className:`px-3 py-1 rounded-full font-semibold text-xs
                      ${e.status===`COMPLETED`?`bg-emerald-100 text-emerald-700`:e.status===`IN_PROGRESS`?`bg-blue-100 text-blue-700`:e.status===`CANCELLED`?`bg-red-100 text-red-700`:`bg-slate-100 text-slate-700`}`,children:b(e.status)})}),(0,_.jsx)(`td`,{className:`px-6 py-4 text-sm`,children:(0,_.jsx)(`span`,{className:`px-3 py-1 rounded-full font-semibold text-xs
                      ${e.priority===`URGENT`||e.priority===`STAT`?`bg-amber-100 text-amber-700`:e.priority===`HIGH`?`bg-orange-100 text-orange-700`:e.priority===`NORMAL`?`bg-green-100 text-green-700`:`bg-slate-100 text-slate-700`}`,children:e.priority})}),(0,_.jsx)(`td`,{className:`px-6 py-4`,children:(0,_.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,_.jsx)(`button`,{onClick:()=>d(`/test-orders/${e.id}`),className:`p-2 rounded-lg hover:bg-cyan-50 hover:scale-110 transition`,children:(0,_.jsx)(f,{className:`w-5 h-5 text-gray-500 hover:text-cyan-600`})}),(0,_.jsx)(`button`,{onClick:()=>ne(e.id),className:`p-2 rounded-lg hover:bg-yellow-50 hover:scale-110 transition`,children:(0,_.jsx)(t,{className:`w-5 h-5 text-gray-500 hover:text-yellow-600`})}),(0,_.jsx)(`button`,{onClick:()=>re(e),className:`p-2 rounded-lg hover:bg-red-50 hover:scale-110 transition`,children:(0,_.jsx)(r,{className:`w-5 h-5 text-red-600 hover:text-red-700`})})]})})]},e.id))})]})}),(0,_.jsx)(m,{page:I,size:10,currentPageSize:E.length,totalElements:B,totalPages:R,onPageChange:e=>{Z(O,M,P,e)}})]})]})]}),(0,_.jsx)(e,{open:H,onClose:()=>U(!1),itemId:W})]})):(0,_.jsx)(`div`,{className:`p-10 text-center`,children:`Record not found.`})}export{x as default};