import{t as e}from"./calendar-aV5gGbf_.js";import{t}from"./house-IZk9q2Ov.js";import{n,t as r}from"./phone-CFTnPSRe.js";import{t as i}from"./user-check-BukfIEMx.js";import{A as a,D as o,G as s,J as c,O as l,W as u,Y as d,c as f,j as p,q as m,tt as h,u as g,x as _}from"./index-BK-GGJM4.js";var v=h(d(),1),y=h(u(),1),b=h(a(),1),x=`https://be2.flaboratory.cloud`;function S(e=``){return String(e).normalize(`NFD`).replace(/[\u0300-\u036f]/g,``).replace(/đ/g,`d`).replace(/Đ/g,`D`)}function C(e=``){return String(e).replace(/\s+/g,` `).replace(/[\r\n\t]+/g,` `).trim()}function w(e,t=300){let[n,r]=(0,v.useState)(e);return(0,v.useEffect)(()=>{let n=setTimeout(()=>r(e),t);return()=>clearTimeout(n)},[e,t]),n}function T(e){let t=(0,v.useRef)(null);return(0,v.useEffect)(()=>{function n(n){t.current&&!t.current.contains(n.target)&&e()}return document.addEventListener(`mousedown`,n),()=>document.removeEventListener(`mousedown`,n)},[e]),t}function E({value:e,onChange:t,options:n,placeholder:r,disabled:i,loading:a,noOptionsText:o,searchPlaceholder:s,renderIcon:c,clearable:l=!0,className:u=``,debounceMs:d=300}){let[f,p]=(0,v.useState)(!1),[m,h]=(0,v.useState)(``),[g,_]=(0,v.useState)(-1),y=w(m,d),x=T(()=>{p(!1),h(``),_(-1)}),C=(0,v.useMemo)(()=>n.find(t=>String(t.value)===String(e))||null,[n,e]),E=(0,v.useMemo)(()=>{if(!y.trim())return n;let e=S(y.trim().toLowerCase());return n.filter(t=>S(String(t.label).toLowerCase()).includes(e))},[n,y]);(0,v.useEffect)(()=>{f||(h(``),_(-1))},[f]);function D(e){if(!f){[`ArrowDown`,`Enter`,` `].includes(e.key)&&(e.preventDefault(),p(!0),_(0));return}if(e.key===`Escape`){e.preventDefault(),p(!1);return}e.key===`ArrowDown`?(e.preventDefault(),_(e=>Math.min(e+1,E.length-1))):e.key===`ArrowUp`?(e.preventDefault(),_(e=>Math.max(e-1,0))):e.key===`Enter`&&(e.preventDefault(),E[g]&&(t(E[g].value),p(!1)))}return(0,b.jsxs)(`div`,{ref:x,className:`relative ${u}`,children:[(0,b.jsx)(`button`,{type:`button`,disabled:i,onClick:()=>p(e=>!e),onKeyDown:D,className:`w-full rounded-xl border-2 px-4 py-3 text-left transition-all
          ${i?`bg-gray-50 cursor-not-allowed`:`bg-white hover:border-emerald-400`}
          ${f?`border-emerald-500`:`border-gray-200`}`,"aria-haspopup":`listbox`,"aria-expanded":f,children:(0,b.jsxs)(`div`,{className:`flex items-center gap-2`,children:[c&&(0,b.jsx)(`span`,{className:`text-gray-400`,children:c}),(0,b.jsx)(`span`,{className:`${C?`text-gray-900`:`text-gray-400`}`,children:C?C.label:r||``}),(0,b.jsx)(`span`,{className:`ml-auto text-gray-400`,children:a?`…`:f?`▲`:`▼`}),l&&C&&!i&&(0,b.jsx)(`span`,{onClick:e=>{e.stopPropagation(),t(``)},className:`ml-2 text-gray-400 hover:text-gray-600 px-2`,children:`×`})]})}),f&&(0,b.jsxs)(`div`,{className:`absolute z-50 mt-2 w-full rounded-xl border-2 border-emerald-200 bg-white shadow-xl`,children:[(0,b.jsx)(`div`,{className:`p-2`,children:(0,b.jsx)(`input`,{autoFocus:!0,value:m,onChange:e=>{h(e.target.value),_(0)},onKeyDown:D,placeholder:s||`Search...`,className:`w-full rounded-lg border-2 border-gray-200 px-3 py-2 focus:outline-none focus:border-emerald-500`})}),(0,b.jsx)(`div`,{className:`max-h-64 overflow-auto py-1`,children:a?(0,b.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:`Loading...`}):E.length===0?(0,b.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:o||`No options`}):E.map((n,r)=>(0,b.jsx)(`div`,{role:`option`,onMouseEnter:()=>_(r),onMouseDown:e=>e.preventDefault(),onClick:()=>{t(n.value),p(!1)},className:`px-3 py-2 cursor-pointer ${r===g?`bg-emerald-50`:``} ${String(n.value)===String(e)?`font-medium text-emerald-700`:`text-gray-700`}`,children:n.label},n.value))})]})]})}function D(){let{patientId:a}=l(),u=o(),[d,h]=(0,v.useState)({fullName:``,dob:``,gender:`MALE`,contactNumber:``,email:``,provinceCode:``,communeCode:``,houseNumber:``}),[w,T]=(0,v.useState)([]),[D,O]=(0,v.useState)([]),[k,A]=(0,v.useState)(!0),[j,M]=(0,v.useState)(!1),[N,P]=(0,v.useState)(!1),[F,I]=(0,v.useState)({});function L(e){return Array.isArray(e)?e:Array.isArray(e?.content)?e.content:Array.isArray(e?.data)?e.data:Array.isArray(e?.items)?e.items:[]}let R=async(e,t={})=>{let n=localStorage.getItem(`lm.access`);return s({url:`${x}${e}`,...t,headers:{Authorization:`Bearer ${n}`,"Content-Type":`application/json`,...t.headers},withCredentials:!0})};(0,v.useEffect)(()=>{(async()=>{A(!0);try{let e=[];try{let t=await p.get(`/api/v1/addresses/provinces`);e=L(t?.data?.provinces??t?.data),T(e)}catch{}let t=(await R(`/api/v1/patients/${a}`)).data,n=``,r=``,i=t.address||``;if(t.address&&e.length>0){let a=t.address.split(`,`).map(e=>e.trim());if(a.length>=2){let t=a[a.length-1],o=a[a.length-2],s=e.find(e=>S(e.name).toLowerCase()===S(t).toLowerCase());if(s){n=s.code;try{let e=await p.get(`/api/v1/addresses/communes`,{params:{provinceCode:n,size:500,page:0}}),t=L(e?.data?.communes??e?.data);O(t);let s=t.find(e=>S(e.name).toLowerCase()===S(o).toLowerCase());s?(r=s.code,i=a.slice(0,a.length-2).join(`, `)):i=a.slice(0,a.length-1).join(`, `)}catch{}}}}h({fullName:t.fullName||``,dob:t.dob||t.dateOfBirth||``,gender:t.gender||`MALE`,contactNumber:t.contactNumber||t.phoneNumber||``,email:t.email||``,provinceCode:n,communeCode:r,houseNumber:i}),c.success(`Patient data loaded successfully`)}catch(e){let t=e.response?.data?.message||`Failed to load patient`;c.error(t),y.default.fire({icon:`error`,title:`Error`,text:t}).then(()=>u(`/patients`))}finally{A(!1)}})()},[a,u]),(0,v.useEffect)(()=>{if(k)return;let{provinceCode:e}=d;if(!e){O([]),h(e=>({...e,communeCode:``}));return}M(!0),p.get(`/api/v1/addresses/communes`,{params:{provinceCode:e,size:500,page:0}}).then(e=>{O(L(e?.data?.communes??e?.data))}).catch(()=>O([])).finally(()=>M(!1))},[d.provinceCode]);let z=()=>{let e={};d.fullName.trim()?/^[\p{L}\s'.-]+$/u.test(d.fullName.trim())||(e.fullName=`Full name must contain only letters`):e.fullName=`Full name is required`,d.dob||(e.dob=`Date of birth is required`);let t=d.contactNumber.trim();return t?/^\d+$/.test(t)?t.length===10?t.startsWith(`0`)||(e.contactNumber=`Phone must start with 0`):e.contactNumber=`Phone must contain exactly 10 digits`:e.contactNumber=`Phone must contain only digits (no letters or special characters)`:e.contactNumber=`Phone number is required`,d.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email.trim())&&(e.email=`Invalid email format`),d.provinceCode||(e.provinceCode=`Province is required`),d.provinceCode&&!d.communeCode&&(e.communeCode=`Commune is required`),d.houseNumber.trim()?/^[\p{L}\d\s,\.]+$/u.test(d.houseNumber.trim())||(e.houseNumber=`House number can contain letters, numbers, commas or dots only`):e.houseNumber=`House number/Street is required`,I(e),Object.keys(e).length===0},B=e=>{let{name:t,value:n}=e.target;h(e=>({...e,[t]:n})),I(e=>({...e,[t]:``}))},V=async e=>{if(e.preventDefault(),z())try{P(!0);let e=w.find(e=>String(e.code)===String(d.provinceCode)),t=D.find(e=>String(e.code)===String(d.communeCode)),n=C(d.houseNumber||``),r=[];n&&r.push(n),t?.name&&r.push(t.name),e?.name&&r.push(e.name);let i=r.join(`, `),o={fullName:d.fullName,dob:d.dob,gender:d.gender,contactNumber:d.contactNumber.trim(),email:d.email,address:i};await R(`/api/v1/patients/${a}`,{method:`PUT`,data:o}),c.success(`Patient updated successfully`),await y.default.fire({icon:`success`,title:`Success`,text:`Patient updated successfully!`,timer:1500,showConfirmButton:!1}),u(`/patients/${a}`)}catch(e){let t=e.response?.data?.message||`Failed to update patient`;c.error(t),y.default.fire({icon:`error`,title:`Error`,text:t})}finally{P(!1)}},H=w.map(e=>({value:e.code,label:e.name})),U=D.map(e=>({value:e.code,label:e.name}));return k?(0,b.jsx)(`div`,{className:`min-h-screen bg-gradient-to-br from-emerald-50 via-sky-50 to-indigo-50 flex items-center justify-center`,children:(0,b.jsxs)(`div`,{className:`text-center`,children:[(0,b.jsx)(`div`,{className:`inline-block w-12 h-12 border-4 border-emerald-200 border-t-emerald-600 rounded-full animate-spin mb-4`}),(0,b.jsx)(`p`,{className:`text-gray-700 font-medium`,children:`Loading patient data...`})]})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(`style`,{children:`
        @keyframes fade-in {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fade-in 0.5s ease-out; }
      `}),(0,b.jsxs)(`div`,{className:`min-h-screen bg-gradient-to-br from-emerald-50 via-sky-50 to-indigo-50 p-6`,children:[(0,b.jsx)(m,{position:`top-right`,pauseOnHover:!0}),(0,b.jsxs)(`div`,{className:`w-full mx-auto`,children:[(0,b.jsxs)(`button`,{onClick:()=>u(`/patients/${a}`),className:`inline-flex items-center gap-2 text-gray-600 hover:text-emerald-600 font-medium mb-6 transition-colors`,children:[(0,b.jsx)(_,{className:`w-5 h-5`}),`Back to Patient Details`]}),(0,b.jsxs)(`div`,{className:`bg-white rounded-3xl shadow-xl p-8 fade-in`,children:[(0,b.jsxs)(`div`,{className:`flex items-center gap-3 mb-8`,children:[(0,b.jsx)(`div`,{className:`p-3 rounded-2xl bg-gradient-to-br from-emerald-500 to-sky-600`,children:(0,b.jsx)(i,{className:`w-8 h-8 text-white`})}),(0,b.jsxs)(`div`,{children:[(0,b.jsx)(`h1`,{className:`text-3xl font-bold bg-gradient-to-r from-emerald-600 to-sky-600 bg-clip-text text-transparent`,children:`Edit Patient`}),(0,b.jsx)(`p`,{className:`text-sm text-gray-500 mt-1`,children:`Update patient information below`})]})]}),(0,b.jsxs)(`form`,{onSubmit:V,className:`space-y-6`,children:[(0,b.jsxs)(`div`,{className:`space-y-4`,children:[(0,b.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,b.jsx)(f,{className:`w-5 h-5 text-emerald-500`}),`Personal Information`]}),(0,b.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Full Name `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsxs)(`div`,{className:`relative`,children:[(0,b.jsx)(f,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,b.jsx)(`input`,{type:`text`,name:`fullName`,value:d.fullName,onChange:B,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),F.fullName&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.fullName})]}),(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Date of Birth `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsxs)(`div`,{className:`relative`,children:[(0,b.jsx)(e,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,b.jsx)(`input`,{type:`date`,name:`dob`,value:d.dob,onChange:B,max:new Date().toISOString().split(`T`)[0],className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),F.dob&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.dob})]})]}),(0,b.jsxs)(`div`,{children:[(0,b.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:`Gender`}),(0,b.jsxs)(`select`,{name:`gender`,value:d.gender,onChange:B,className:`w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-emerald-500 focus:outline-none`,children:[(0,b.jsx)(`option`,{value:`MALE`,children:`Male`}),(0,b.jsx)(`option`,{value:`FEMALE`,children:`Female`}),(0,b.jsx)(`option`,{value:`OTHER`,children:`Other`})]})]})]}),(0,b.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,b.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,b.jsx)(r,{className:`w-5 h-5 text-sky-500`}),`Contact Information`]}),(0,b.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Phone Number `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsxs)(`div`,{className:`relative`,children:[(0,b.jsx)(r,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,b.jsx)(`input`,{type:`text`,name:`contactNumber`,value:d.contactNumber,onChange:B,placeholder:`0123456789`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),F.contactNumber&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.contactNumber})]}),(0,b.jsxs)(`div`,{children:[(0,b.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:`Email`}),(0,b.jsxs)(`div`,{className:`relative`,children:[(0,b.jsx)(g,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,b.jsx)(`input`,{type:`email`,name:`email`,value:d.email,onChange:B,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),F.email&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.email})]})]})]}),(0,b.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,b.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,b.jsx)(n,{className:`w-5 h-5 text-emerald-500`}),`Address Information`]}),(0,b.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Province / City `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsx)(E,{value:d.provinceCode,onChange:e=>h(t=>({...t,provinceCode:e,communeCode:``})),options:H,placeholder:`Select Province`,searchPlaceholder:`Search province...`,noOptionsText:`No results`,loading:!1,disabled:!1,renderIcon:(0,b.jsx)(n,{className:`w-5 h-5`}),debounceMs:250}),F.provinceCode&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.provinceCode})]}),(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`Commune / Ward `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsx)(E,{value:d.communeCode,onChange:e=>h(t=>({...t,communeCode:e})),options:U,placeholder:`Select Commune`,searchPlaceholder:`Search commune...`,noOptionsText:`No results`,loading:j,disabled:!d.provinceCode,renderIcon:(0,b.jsx)(n,{className:`w-5 h-5`}),debounceMs:250}),F.communeCode&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.communeCode})]})]}),(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[`House Number / Street`,` `,(0,b.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,b.jsxs)(`div`,{className:`relative`,children:[(0,b.jsx)(t,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,b.jsx)(`input`,{name:`houseNumber`,value:d.houseNumber,onChange:B,placeholder:`Enter house number, street name...`,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none`})]}),F.houseNumber&&(0,b.jsx)(`p`,{className:`text-red-500 text-sm mt-1`,children:F.houseNumber})]})]}),(0,b.jsxs)(`div`,{className:`flex items-center gap-4 justify-end pt-6 border-t`,children:[(0,b.jsx)(`button`,{type:`button`,onClick:()=>u(`/patients/${a}`),className:`px-6 py-3 rounded-xl border-2 border-gray-200 hover:bg-gray-50 transition-all`,children:`Cancel`}),(0,b.jsx)(`button`,{type:`submit`,disabled:N,className:`px-8 py-3 rounded-xl text-white font-medium shadow-lg bg-gradient-to-r from-emerald-500 to-sky-600 hover:from-sky-600 hover:to-emerald-500 disabled:opacity-50 flex items-center gap-2 transition-all`,children:N?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(`div`,{className:`w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin`}),(0,b.jsx)(`span`,{children:`Saving...`})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i,{className:`w-5 h-5`}),(0,b.jsx)(`span`,{children:`Save Changes`})]})})]})]})]})]})]})]})}export{D as default};