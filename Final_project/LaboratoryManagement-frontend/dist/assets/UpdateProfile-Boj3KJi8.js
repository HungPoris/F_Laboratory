import{t as e}from"./calendar-aV5gGbf_.js";import{t}from"./credit-card-BmLBoDpm.js";import{t as n}from"./house-IZk9q2Ov.js";import{n as r,t as i}from"./phone-CFTnPSRe.js";import{t as a}from"./user-check-BukfIEMx.js";import{A as o,D as s,J as c,K as l,M as u,N as d,W as f,Y as p,c as m,j as h,q as g,tt as _,u as v}from"./index-BK-GGJM4.js";var y=_(p(),1),b=_(f(),1),x=_(o(),1);function S(e=``){return String(e).normalize(`NFD`).replace(/[\u0300-\u036f]/g,``).replace(/đ/g,`d`).replace(/Đ/g,`D`)}function C(e,t=300){let[n,r]=(0,y.useState)(e);return(0,y.useEffect)(()=>{let n=setTimeout(()=>r(e),t);return()=>clearTimeout(n)},[e,t]),n}function w(e){let t=(0,y.useRef)(null);return(0,y.useEffect)(()=>{function n(n){t.current&&!t.current.contains(n.target)&&e()}return document.addEventListener(`mousedown`,n),()=>document.removeEventListener(`mousedown`,n)},[e]),t}function T({value:e,onChange:t,options:n,placeholder:r,disabled:i,loading:a,noOptionsText:o,searchPlaceholder:s,renderIcon:c,clearable:l=!0,className:u=``,debounceMs:d=300}){let[f,p]=(0,y.useState)(!1),[m,h]=(0,y.useState)(``),[g,_]=(0,y.useState)(-1),v=C(m,d),b=w(()=>{p(!1),h(``),_(-1)}),T=(0,y.useMemo)(()=>n.find(t=>String(t.value)===String(e))||null,[n,e]),E=(0,y.useMemo)(()=>{if(!v.trim())return n;let e=S(v.trim().toLowerCase());return n.filter(t=>S(String(t.label).toLowerCase()).includes(e))},[n,v]);(0,y.useEffect)(()=>{f||(h(``),_(-1))},[f]);function D(e){if(!f){(e.key===`ArrowDown`||e.key===`Enter`||e.key===` `)&&(e.preventDefault(),p(!0),_(0));return}if(e.key===`Escape`){e.preventDefault(),p(!1);return}e.key===`ArrowDown`?(e.preventDefault(),_(e=>Math.min(e+1,E.length-1))):e.key===`ArrowUp`?(e.preventDefault(),_(e=>Math.max(e-1,0))):e.key===`Enter`&&(e.preventDefault(),E[g]&&(t(E[g].value),p(!1)))}return(0,x.jsxs)(`div`,{ref:b,className:`relative ${u}`,children:[(0,x.jsx)(`button`,{type:`button`,disabled:i,onClick:()=>p(e=>!e),onKeyDown:D,className:`w-full rounded-xl border-2 px-4 py-3 text-left transition-all
          ${i?`bg-gray-50 cursor-not-allowed`:`bg-white hover:border-emerald-400`}
          ${f?`border-emerald-500`:`border-gray-200`}`,"aria-haspopup":`listbox`,"aria-expanded":f,children:(0,x.jsxs)(`div`,{className:`flex items-center gap-2`,children:[c?(0,x.jsx)(`span`,{className:`text-gray-400`,children:c}):null,(0,x.jsx)(`span`,{className:`${T?`text-gray-900`:`text-gray-400`}`,children:T?T.label:r||``}),(0,x.jsx)(`span`,{className:`ml-auto text-gray-400`,children:a?`…`:f?`▲`:`▼`}),l&&T&&!i&&(0,x.jsx)(`span`,{onClick:e=>{e.stopPropagation(),t(``)},className:`ml-2 text-gray-400 hover:text-gray-600 px-2`,role:`button`,"aria-label":`Clear`,title:`Clear`,children:`×`})]})}),f&&(0,x.jsxs)(`div`,{className:`absolute z-50 mt-2 w-full rounded-xl border-2 border-emerald-200 bg-white shadow-xl`,role:`listbox`,children:[(0,x.jsx)(`div`,{className:`p-2`,children:(0,x.jsx)(`input`,{autoFocus:!0,value:m,onChange:e=>{h(e.target.value),_(0)},onKeyDown:D,placeholder:s||`Search...`,className:`w-full rounded-lg border-2 border-gray-200 px-3 py-2 focus:outline-none focus:border-emerald-500`})}),(0,x.jsx)(`div`,{className:`max-h-64 overflow-auto py-1`,children:a?(0,x.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:`Loading...`}):E.length===0?(0,x.jsx)(`div`,{className:`px-3 py-2 text-sm text-gray-500`,children:o||`No options`}):E.map((n,r)=>(0,x.jsx)(`div`,{role:`option`,"aria-selected":String(n.value)===String(e),onMouseEnter:()=>_(r),onMouseDown:e=>e.preventDefault(),onClick:()=>{t(n.value),p(!1)},className:`px-3 py-2 cursor-pointer
                    ${r===g?`bg-emerald-50`:``}
                    ${String(n.value)===String(e)?`font-medium text-emerald-700`:`text-gray-700`}`,children:n.label},n.value))})]})]})}function E(){let{t:o}=l(),f=s(),[p,_]=(0,y.useState)([]),[S,C]=(0,y.useState)([]),[w,E]=(0,y.useState)(!1),[D,O]=(0,y.useState)(!1),[k,A]=(0,y.useState)(!0),[j,M]=(0,y.useState)(``),[N,P]=(0,y.useState)({username:``,fullName:``,email:``,phoneNumber:``,dateOfBirth:``,identityNumber:``,gender:``,house:``,provinceCode:``,communeCode:``}),[F,I]=(0,y.useState)({});function L(e){return Array.isArray(e)?e:Array.isArray(e?.content)?e.content:Array.isArray(e?.data)?e.data:Array.isArray(e?.items)?e.items:Array.isArray(e?.results)?e.results:e&&typeof e==`object`?Object.values(e):[]}(0,y.useEffect)(()=>{let e=!0;return A(!0),Promise.all([h.get(`/api/v1/profile`).catch(()=>null),h.get(`/api/v1/addresses/provinces`).catch(()=>null)]).then(([t,n])=>{if(!e)return;let r=t?.data||{};P(e=>({...e,username:r.username||``,fullName:r.fullName||``,email:r.email||``,phoneNumber:r.phoneNumber||``,dateOfBirth:r.dateOfBirth||``,identityNumber:r.identityNumber||``,gender:(r.gender||``).toUpperCase()===`MALE`?`MALE`:(r.gender||``).toUpperCase()===`FEMALE`?`FEMALE`:(r.gender||``).toUpperCase()===`OTHER`?`OTHER`:``,house:``,provinceCode:``,communeCode:``})),M(r.address||``),_(L(n?.data?.provinces??n?.data))}).finally(()=>A(!1)),()=>{e=!1}},[]),(0,y.useEffect)(()=>{let{provinceCode:e}=N;if(!e){C([]);return}E(!0),h.get(`/api/v1/addresses/communes`,{params:{provinceCode:e,size:500,page:0}}).then(e=>{C(L(e?.data?.communes??e?.data))}).catch(()=>{C([]),c.error(o(`errors.FETCH_COMMUNES_FAILED`))}).finally(()=>E(!1))},[N.provinceCode,o]);function R(){let e={},t=N.fullName?.trim()||``;t?t.length<4||t.length>128?e.fullName=o(`errors.FULL_NAME_SIZE`):/^[\p{L}\s]+$/u.test(t)||(e.fullName=o(`errors.FULL_NAME_PATTERN`)):e.fullName=o(`admin.full_name_required`);let n=N.email?.trim()||``;n?/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(n)||(e.email=o(`errors.EMAIL_INVALID`)):e.email=o(`admin.email_required`);let r=(N.phoneNumber||``).trim();r&&!/^\d{10}$/.test(r)&&(e.phoneNumber=o(`errors.PHONE_INVALID`));let i=(N.identityNumber||``).trim();i&&!/^\d{12}$/.test(i)&&(e.identityNumber=o(`errors.IDENTITY_INVALID`));let a=N.dateOfBirth;if(a){let t=new Date(a),n=new Date;(isNaN(t.getTime())||t>=new Date(n.getFullYear(),n.getMonth(),n.getDate()))&&(e.dateOfBirth=o(`errors.DATE_OF_BIRTH_PAST`))}return I(e),Object.keys(e).length===0}function z(e,t=null){if(!e||typeof e!=`object`)return o(t===401?`errors.UNAUTHORIZED`:t===403?`errors.FORBIDDEN`:t===404?`errors.USER_NOT_FOUND`:`errors.UNKNOWN_ERROR`);if(e.message&&typeof e.message==`string`){let t=e.message.trim();if(t&&!/^[A-Z0-9_]+$/.test(t)&&!/^[a-z0-9_]+$/.test(t))return t}let n=e.error||e.code||e.message||null;if(!n&&e.errors&&typeof e.errors==`object`)try{let t=Object.values(e.errors).flat();t.length&&(n=t[0])}catch{}if(n){let e=String(n).trim().toUpperCase(),t=o(`errors.${e}`,{defaultValue:``});if(t&&t!==`errors.${e}`)return t;let r=o(`errors.${e}`,{defaultValue:``})||o(`errors.VALIDATION_FAILED`,{defaultValue:``});if(r)return r}return o(t===401?`errors.UNAUTHORIZED`:t===403?`errors.FORBIDDEN`:`errors.UNKNOWN_ERROR`)}function B(e){return(Array.isArray(p)?p:L(p)).find(t=>t.code===e)||null}function V(e){return(Array.isArray(S)?S:L(S)).find(t=>t.code===e)||null}async function H(e){e&&e.preventDefault();try{let e=d();if(!e||String(e).trim().length===0){c.error(o(`errors.SESSION_EXPIRED`));try{u(),delete h.defaults.headers.common.Authorization}catch{}f(`/login`);return}}catch{}if(R()){O(!0);try{let e=B(N.provinceCode),t=V(N.communeCode),n=[];N.house&&N.house.trim().length>0&&n.push(N.house.trim()),t&&t.name&&n.push(t.name),e&&e.name&&n.push(e.name);let r=n.join(`, `),i=N.gender===`FEMALE`?`female`:N.gender===`MALE`?`male`:N.gender===`OTHER`?null:N.gender||null,a={fullName:N.fullName?.trim(),email:N.email?.trim(),phoneNumber:N.phoneNumber?N.phoneNumber.trim():null,dateOfBirth:N.dateOfBirth||null,identityNumber:N.identityNumber?N.identityNumber.trim():null,gender:i,address:r||void 0};await h.put(`/api/v1/profile`,a),c.success(o(`profile.update_success`)),await b.default.fire(o(`common.success`),o(`profile.update_success`),`success`),f(`/profile`)}catch(e){let t=z(e?.response?.data,e?.response?.status)||o(`profile.update_failed`);b.default.fire(o(`common.error`),t,`error`)}finally{O(!1)}}}let U=Array.isArray(p)?p:L(p),W=Array.isArray(S)?S:L(S),G=U.map(e=>({value:e.code,label:e.name})),K=W.map(e=>({value:e.code,label:e.name}));return k?(0,x.jsx)(`div`,{className:`py-16 flex items-center justify-center`,children:(0,x.jsx)(`div`,{className:`w-10 h-10 border-2 border-gray-300 border-t-transparent rounded-full animate-spin`})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(g,{position:`top-right`,pauseOnHover:!0}),(0,x.jsxs)(`div`,{children:[(0,x.jsxs)(`div`,{className:`flex items-center gap-3 mb-8`,children:[(0,x.jsx)(`div`,{className:`p-3 rounded-2xl bg-gradient-to-br from-emerald-500 to-sky-600`,children:(0,x.jsx)(a,{className:`w-8 h-8 text-white`})}),(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`h1`,{className:`text-3xl font-bold bg-gradient-to-r from-emerald-600 to-sky-600 bg-clip-text text-transparent`,children:o(`profile.title`)}),(0,x.jsx)(`p`,{className:`text-sm text-gray-500 mt-1`,children:o(`profile.subtitle`)})]})]}),(0,x.jsxs)(`form`,{onSubmit:H,className:`space-y-6`,children:[(0,x.jsxs)(`div`,{className:`space-y-4`,children:[(0,x.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,x.jsx)(m,{className:`w-5 h-5 text-emerald-500`}),o(`profile.section_signin`)]}),(0,x.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.username`)}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(m,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.username,readOnly:!0,className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 bg-gray-50`})]})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[o(`profile.full_name`),(0,x.jsx)(`span`,{className:`text-red-500`,children:` *`})]}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(m,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.fullName,onChange:e=>P({...N,fullName:e.target.value}),placeholder:o(`profile.placeholder_full_name`),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]}),F.fullName&&(0,x.jsx)(`div`,{className:`text-sm text-red-600 mt-1`,children:F.fullName})]})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsxs)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:[o(`profile.email`),` `,(0,x.jsx)(`span`,{className:`text-red-500`,children:`*`})]}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(v,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.email,onChange:e=>P({...N,email:e.target.value}),placeholder:o(`profile.placeholder_email`),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]}),F.email&&(0,x.jsx)(`div`,{className:`text-sm text-red-600 mt-1`,children:F.email})]})]}),(0,x.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,x.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,x.jsx)(t,{className:`w-5 h-5 text-sky-500`}),o(`profile.section_personal`)]}),(0,x.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.phone_number`)}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(i,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.phoneNumber,onChange:e=>P({...N,phoneNumber:e.target.value}),placeholder:o(`profile.placeholder_phone`),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]}),F.phoneNumber&&(0,x.jsx)(`div`,{className:`text-sm text-red-600 mt-1`,children:F.phoneNumber})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.date_of_birth`)}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(e,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{type:`date`,value:N.dateOfBirth,onChange:e=>P({...N,dateOfBirth:e.target.value}),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]}),F.dateOfBirth&&(0,x.jsx)(`div`,{className:`text-sm text-red-600 mt-1`,children:F.dateOfBirth})]})]}),(0,x.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.identity_number`)}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(t,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.identityNumber,onChange:e=>P({...N,identityNumber:e.target.value}),placeholder:o(`profile.placeholder_identity`),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]}),F.identityNumber&&(0,x.jsx)(`div`,{className:`text-sm text-red-600 mt-1`,children:F.identityNumber})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.gender`)}),(0,x.jsxs)(`select`,{value:N.gender,onChange:e=>P({...N,gender:e.target.value}),className:`w-full rounded-xl border-2 border-gray-200 px-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`,children:[(0,x.jsx)(`option`,{value:``,children:o(`profile.select_gender`)}),(0,x.jsx)(`option`,{value:`MALE`,children:o(`profile.gender_male`)}),(0,x.jsx)(`option`,{value:`FEMALE`,children:o(`profile.gender_female`)}),(0,x.jsx)(`option`,{value:`OTHER`,children:o(`profile.gender_other`)})]})]})]})]}),(0,x.jsxs)(`div`,{className:`space-y-4 pt-6 border-t`,children:[(0,x.jsxs)(`h3`,{className:`text-lg font-semibold text-gray-700 flex items-center gap-2`,children:[(0,x.jsx)(r,{className:`w-5 h-5 text-emerald-500`}),o(`profile.section_address`)]}),j?(0,x.jsxs)(`div`,{className:`grid grid-cols-1 gap-3`,children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700`,children:o(`profile.current_address`)}),(0,x.jsx)(`input`,{value:j,readOnly:!0,className:`w-full rounded-xl border-2 border-gray-200 px-4 py-3 bg-gray-50 text-gray-700`})]}):null,(0,x.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-6`,children:[(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.province`)}),(0,x.jsx)(T,{value:N.provinceCode,onChange:e=>P({...N,provinceCode:e,communeCode:``}),options:G,placeholder:o(`profile.select_province`),searchPlaceholder:o(`profile.search_placeholder`),noOptionsText:o(`profile.no_results`),loading:!1,disabled:!1,renderIcon:(0,x.jsx)(r,{className:`w-5 h-5`}),debounceMs:250})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.commune`)}),(0,x.jsx)(T,{value:N.communeCode,onChange:e=>P({...N,communeCode:e}),options:K,placeholder:o(`profile.select_commune`),searchPlaceholder:o(`profile.search_placeholder`),noOptionsText:o(`profile.no_results`),loading:w,disabled:!N.provinceCode,renderIcon:(0,x.jsx)(r,{className:`w-5 h-5`}),debounceMs:250})]})]}),(0,x.jsxs)(`div`,{children:[(0,x.jsx)(`label`,{className:`block text-sm font-medium text-gray-700 mb-2`,children:o(`profile.house`)}),(0,x.jsxs)(`div`,{className:`relative`,children:[(0,x.jsx)(n,{className:`absolute left-3 top-3.5 w-5 h-5 text-gray-400 pointer-events-none`}),(0,x.jsx)(`input`,{value:N.house,onChange:e=>P({...N,house:e.target.value}),placeholder:o(`profile.placeholder_house`),className:`w-full rounded-xl border-2 border-gray-200 pl-10 pr-4 py-3 focus:border-emerald-500 focus:outline-none transition-all`})]})]})]}),(0,x.jsxs)(`div`,{className:`flex items-center gap-4 justify-end pt-6 border-t`,children:[(0,x.jsx)(`button`,{type:`button`,onClick:()=>f(`/profile`),className:`px-6 py-3 rounded-xl border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition-all font-medium`,children:o(`common.cancel`)}),(0,x.jsx)(`button`,{type:`submit`,disabled:D,className:`px-8 py-3 rounded-xl text-white font-medium shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all bg-gradient-to-r from-emerald-500 to-sky-600 hover:from-sky-600 hover:to-emerald-500 flex items-center gap-2`,children:D?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(`div`,{className:`w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin`}),(0,x.jsx)(`span`,{children:o(`profile.saving`)})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(a,{className:`w-5 h-5`}),(0,x.jsx)(`span`,{children:o(`profile.save_changes`)})]})})]})]})]})]})}export{E as default};